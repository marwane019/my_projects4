<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>CMB Spectrum — Interactive</title>
<link rel="stylesheet" href="../../assets/css/style.css">
</head><body>
<header class="nav"><div class="container"><a class="brand" href="../../index.html">← Back</a><div class="badge">Canvas</div></div></header>
<section class="container prose">
  <h2>CMB Spectrum — Interactive</h2>
  <p>Adjust parameters and see the toy Sachs–Wolfe spectrum update live. Everything runs client‑side.</p>
  <div class="controls">
    <label>lmax <input id="lmax" type="range" min="200" max="2500" value="1500"></label>
    <label>As <input id="As" type="range" min="1.0e-9" max="4.0e-9" step="1.0e-10" value="2.1e-9"></label>
    <label>ns <input id="ns" type="range" min="0.8" max="1.2" step="0.005" value="0.965"></label>
    <button class="btn" id="reset">Reset</button>
    <button class="btn" id="csv">Download CSV</button>
  </div>
  <div class="kpi">Points: <span id="kPoints">0</span></div>
  <div class="center"><canvas id="plot" width="900" height="440" class="img-frame"></canvas></div>
  <h3>How it works</h3>
  <p>We plot Dl = l(l+1)Cl / 2π with Cl ≈ As·l^(ns−3). Sliders drive the parameters.</p>
</section>
<footer><div class="container">Contact: <a href="mailto:ambrosetheshield6@gmail.com">ambrosetheshield6@gmail.com</a></div></footer>
<script>
const cv=document.getElementById('plot'),ctx=cv.getContext('2d');
const lmaxEl=document.getElementById('lmax'), AsEl=document.getElementById('As'), nsEl=document.getElementById('ns');
const kPoints=document.getElementById('kPoints');
document.getElementById('reset').onclick=()=>{lmaxEl.value=1500;AsEl.value=2.1e-9;nsEl.value=0.965;draw()};
function cl(ell,As,ns){return As*Math.pow(Math.max(ell,1), ns-3.0)}
function compute(){
  const lmax=+lmaxEl.value, As=+AsEl.value, ns=+nsEl.value;
  const ell=Array.from({length:lmax-1},(_,i)=>i+2);
  const Dl=ell.map(l=> l*(l+1)*cl(l,As,ns)/(2*Math.PI));
  kPoints.textContent = Dl.length;
  return {ell,Dl,As,ns}
}
function draw(){
  const {ell,Dl}=compute();
  ctx.clearRect(0,0,cv.width,cv.height);
  const pad=50,w=cv.width-2*pad,h=cv.height-2*pad;
  ctx.strokeStyle='#1a2240';ctx.lineWidth=1;ctx.strokeRect(pad,pad,w,h);
  const xmin=ell[0],xmax=ell[ell.length-1];
  const vals=Dl.filter(x=>x>0); const ymin=Math.min(...vals)*0.9, ymax=Math.max(...vals)*1.2;
  const lx=x=>pad+(Math.log10(x)-Math.log10(xmin))/(Math.log10(xmax)-Math.log10(xmin))*w;
  const ly=y=>pad+(1-(Math.log10(y)-Math.log10(ymin))/(Math.log10(ymax)-Math.log10(ymin)))*h;
  ctx.beginPath();ctx.strokeStyle='#5ea0ff';ctx.lineWidth=2;
  for(let i=0;i<ell.length;i++){const x=lx(ell[i]),y=ly(Dl[i]); if(i===0)ctx.moveTo(x,y); else ctx.lineTo(x,y);} ctx.stroke();
}
[lmaxEl,AsEl,nsEl].forEach(el=>el.addEventListener('input',draw)); draw();
document.getElementById('csv').onclick=()=>{
  const {ell,Dl}=compute();
  let csv='ell,Dl\\n'; for(let i=0;i<ell.length;i++) csv+=ell[i]+','+Dl[i]+'\\n';
  const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='cmb_spectrum.csv'; a.click(); URL.revokeObjectURL(url);
};
</script>
</body></html>
